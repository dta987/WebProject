create user yamaman_db identified by oracle account unlock;

grant connect, resource to yamaman_db;

--2016/07/19 수정 성진


//////테이블 생성/////////////

create table members(
	user_id varchar2(15) primary key,
	user_password varchar2(15),
	user_name varchar2(20),
	user_email varchar2(30),
	user_nickname varchar2(20) UNIQUE,
	user_img varchar2(50),
	sign_date date default sysdate,
	user_title varchar2(1000)
);

create table boards(
	board_no number primary key,	
	board_category number,
	board_title varchar2(30),
	board_writer varchar2(15),
	board_writ_date date default sysdate,
	board_update date default sysdate,
	board_content varchar2(500),
	board_img varchar2(1000),
	board_readhit number default 0,
	user_nickname varchar2(20),
	group_no number default 0,
	order_no number default 0,
	depth number default 0,
	constraint board_writer_fk 
	foreign key(board_writer) references members(user_id) 
	on delete set null
);

create table Mountains(
	mountain_no number primary key,
	mountain_name varchar2(30),
	mountain_area varchar2(20),
	mountain_address varchar2(60),
	mountain_img varchar2(1000),
	mountain_introduce varchar2(500),
	mountain_thema number
);

create table mountains_history(
	history_no number,
	user_id varchar2(15),
	mountain_no number,
	hiking_date date,
	constraint history_user_id_fk
	foreign key(user_id) references members(user_id) 
	on delete set null,
	constraint history_mountain_no_fk
	foreign key(mountain_no) references mountains(mountain_no) 
	on delete set null
);

create table title(
	title_no number primary key,
	title_name varchar(30),
	title_condition varchar(60),
	title_img varchar(50)
);






-- create table user_title(
--	user_title_no number primary key,
--	user_id varchar2(15),
--	title_no number,
--	constraint user_title_no_fk
--	foreign key(title_no) references Title(title_no)
--	on delete set null
--);

//////<MemberDao>//////
-로그인
select user_id, user_passowrd, user_nickname from members where user_id=? and user_password=?;

-아이디 중복확인
select user_id from members where user_id=?;

-닉네임 중복확인
select user_nickname members where user_nickname=?; 

-회원가입
insert into members( 
user_id, user_password, user_name, user_email, user_nickName, sign_date ) 
values( ?, ?, ?, ?, ?, to_date(sysdate, yyyy/MM/dd HH:mm:ss)) ;

-회원 정보수정
update members set( 
user_password=?, user_name=?, user_email=?, user_nickName=?, user_img=? where user_id=?) ;

-회원탈퇴
delete from members where user_id=?;

-회원 user_id로 조회 
select * from members where user_id=?;

-회원 user_nickname로 조회
select * from members where user_nickname=?;

-사용자가 획득한 타이틀
select user_title from members where user_id=?;


///////<TitleDao> 게시판///////
-타이틀 목록
select * from title;

-타이틀 조회(타이틀 이름)
select * from title where title_name like '%" + search_title + "%' order by title_no desc;

-타이틀 조회(타이틀 조건)
select * from title where title_condition like '%" + search_title + "%' order by title_no desc;



///////<BoardDao> 게시판///////

-게시글 조회(작성자)
select * from boards where board_writer like '%" + search_writer + "%' order by board_writ_date desc;

-게시글 조회(제목)
select * from boards where board_title like '%" + search_title + "%' order by board_writ_date desc;

-게시글 보기
select board_no, board_title, board_writer, board_writ_date, board_update, board_content, board_readhit, user_nickname, group_no 
from boards where board_no=?;
select board_writer, board_writ_date, board_update, board_content, user_nickname where group_no=? and order_no > 0;

-게시글 작성
insert into boards( board_no, board_category, board_title, board_writer, board_writ_date, board_update, board_content, board_img, board_readhit, user_nickName, group_no, ordeer_no, depth) 
values( board_no_seq, ?, ?, ?, to_date(?, yyyy/MM/dd'), to_date(?, yyyy/MM/dd'), ?, ?, ?, ?, ?, ?, ?);

-게시글 수정
update boards set board_title=?, board_update=?, board_content=?, board_img=?, where board_no=? ;

-게시글 삭제
delete from boards where board_no=? and board_writer ;

-게시글 리스트(한페이지에 10개씩)
select board_no, board_title, board_writer, board_writ_date, board_readhit, ranking
from 
(
	board_no, board_title, board_writer, board_writ_date, board_readhit, rank() over( order by board_no desc ) as ranking
	from boards 
)
where ranking between ? and ? ;

-게시글 리스트(한페이지에 10개씩 - 조회수순)
select board_no, board_title, board_writer, board_writ_date, board_readhit, ranking
from 
(
	board_no, board_title, board_writer, board_writ_date, board_readhit, rank() over( order by board_readhit desc ) as ranking
	from boards 
)
where ranking between ? and ?   ;  

-게시글 리스트(한페이지에 10개씩 - 날짜순)
select board_no, board_title, board_writer, board_writ_date, board_readhit, ranking
from 
(
	board_no, board_title, board_writer, board_writ_date, board_readhit, rank() over( order by board_writ_date desc ) as ranking
	from boards 
)
where ranking between ? and ?   ;  


///////<MountainDao> 산////////
-산 조회(이름)
select * from mountains where mountain_name=?;

-산 조회(지역)
select * form mountains where mountain_address1=?; 

-산 추가
insert into mountains( 
mountain_no, mountain_name, mountain_address1, mountain_address1, mountain_img, mountain_introduce, mountain_thema) 
values( mountain_no_sq, ?, ?, ?, ?, ?, ?) ;

-산 수정
update moun
tains set mountain_name=?, mountain_address1=?, mountain_address1=?, mountain_img=?, mountain_introduce=?, mountain_thema where mountain_no=? ;

-산 삭제
delete from mountains where mountain_no=? ;

-사용자가 오른산
select mountains.name, history.history_no, hiking_date 
from mountains_history history inner join mountaions 
on mountains.mountain_no=history.history_no
order by hiking_date desc;


/////// 시쿼스 생성 ////////

--mountain_no
create sequence mountain_no_seq start with 1 increment by 1 nocache;

--board_no
create sequence board_no_seq start with 1 increment by 1 nocache;

--history_no
create sequence history_no_seq start with 1 increment by 1 nocache;

--title_no
create sequence title_no_seq start with 1 increment by 1 nocache;

--user_title_no
create sequence user_title_no_seq start with 1 increment by 1 nocache;








